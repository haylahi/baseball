<?xml version="1.0" encoding="utf-8"?>
<openerp>
  <data>

<template id="profile" name="Profile page">                
  <t t-call="website.layout">
      <div id="wrap" class="js_sale">
        <div class="oe_structure"/>
          <div class="container">
            <div class='row'>
              <div class="col-lg-12">
                <div class="panel panel-default">
                  <div class="panel-heading" style="border-bottom: 0px;padding: 0px;">
                      <ul class="nav nav-tabs" style="padding-left: 20px;">
                        <t t-foreach="(user.child_partner_ids | user.partner_id)" t-as="child_partner">
                          <li t-att-class="'active' if (user.current_partner_id == child_partner) else ''">
                            <a t-att-href="'#tabpartner%s' % child_partner.id" data-toggle="tab">
                              <span t-field="child_partner.name"/>
                            </a>
                          </li>
                        </t>
                      </ul>
                  </div>
                  <div class="panel-body">
                    <div class="tab-content">
                        <t t-foreach="user.child_partner_ids | user.partner_id" t-as="child_partner">
                          <t t-set="is_current" t-value="child_partner==user.current_partner_id"/>
                          <div t-att-class="'tab-pane fade in active' if is_current else 'tab-pane fade in'" t-att-id="'tabpartner%s' % child_partner.id">
                            <H3>Données</H3>
                            <div t-if="not is_current" class="text-center">
                              <a t-att-href="'/profile?current_partner=%s' % child_partner.id" class="btn btn-primary">Changer de profil</a>
                            </div>
                            <div class="row">
                            <t t-if="child_partner.image">
                              <div class="col-lg-2">
                                <div class="pull-right" >
                                  <img class="img img-responsive" t-att-src="'data:image/png;base64,'+child_partner.image" style="max-width: 150px;" />
                                </div>
                              </div>
                            </t>
                            <div class="col-lg-10">
                              <table class="table table-condensed table-profile">
                                <tbody>
                                    <tr>
                                      <td style="font-weight: bold;">Nom</td>
                                      <td><span t-field="child_partner.name"/></td>
                                      <td style="font-weight: bold;">Numéro de licence</td>
                                      <td><span t-field="child_partner.licence_number"/></td>
                                    </tr><tr>
                                      <td style="font-weight: bold;">Email</td>
                                      <td><span t-field="child_partner.email"/></td>
                                      <td style="font-weight: bold;">Adresse</td>
                                      <td><span t-field="child_partner.street"/></td>
                                    </tr><tr>
                                      <td style="font-weight: bold;">Date de naissance</td>
                                      <td><span t-field="child_partner.birthdate"/></td>
                                      <td/>
                                      <td><span t-field="child_partner.street2"/></td>
                                    </tr><tr>
                                      <td style="font-weight: bold;">Téléphone</td>
                                      <td><span t-field="child_partner.phone"/></td>
                                      <td/>
                                      <td><span t-field="child_partner.zip"/> <span t-field="child_partner.city"/></td>
                                    </tr><tr>
                                      <td style="font-weight: bold;">Mobile</td>
                                      <td><span t-field="child_partner.mobile"/></td>
                                      <td style="font-weight: bold;">NAtionalité</td>
                                      <td><span t-field="child_partner.country_id.name"/></td>
                                    </tr><tr>
                                      <td style="font-weight: bold;">Sexe</td>
                                      <td><span t-field="child_partner.gender"/></td>
                                    </tr>
                                </tbody>
                              </table>
                            </div>
                            </div>

                            <div t-if="is_current" class="text-center">
                              <span>Des données manquantes ou erronée? Mettez les à jour</span>
                              <br/>
                              <a href="/web/reset_password" class="btn btn-primary">Reset password</a> <a href="/web/update_profile" class="btn btn-primary">Update</a> <a href="/web/add_child_partner" class="btn btn-primary">Ajoutez un enfant</a>
                            </div>
                            <div class="row">
                              <div class="col-lg-6">
                                <H3>Cotisations</H3>
                                <t t-set="current_season" t-value="request.env['baseball.season'].sudo().get_current_season()"/>                        
                                  <t t-set="current_registration" t-value="child_partner.season_ids.filtered(lambda r, current_season=current_season: r.season_id == current_season)"/>
                                  <t t-set="currency" t-value="request.env['res.company'].search([])[0].currency_id"/>
                                <table class="table table-condensed">
                                  <thead>
                                      <tr>
                                        <th>Saison</th>
                                        <th>Cotisation</th>
                                        <th>Payé</th>
                                        <th>Dû</th>
                                      </tr>
                                  </thead>
                                  <tbody>
                                      <tr>
                                        <td><span t-field="current_registration.season_id.name"/></td>
                                        <td><span t-field="current_registration.fee_to_pay" t-field-options='{"widget": "monetary", "display_currency": "currency"}'/></td>
                                        <td><span t-field="current_registration.fee_paid" t-field-options='{"widget": "monetary", "display_currency": "currency"}'/></td>
                                        <td><span t-esc="current_registration.fee_to_pay - current_registration.fee_paid" t-esc-options='{"widget": "monetary", "display_currency": "currency"}'/></td>
                                      </tr>
                                      <t t-foreach="child_partner.season_ids.filtered(lambda r, current_season=current_season: r.season_id != current_season and int(round(r.fee_to_pay-r.fee_paid))==0 )" t-as="other_registration">
                                        <tr>
                                          <td><span t-field="other_registration.season_id.name"/></td>
                                          <td><span t-field="other_registration.fee_to_pay" t-field-options='{"widget": "monetary", "display_currency": "currency"}'/></td>
                                          <td><span t-field="other_registration.fee_paid" t-field-options='{"widget": "monetary", "display_currency": "currency"}'/></td>
                                          <td><span t-esc="other_registration.fee_to_pay - other_registration.fee_paid" t-esc-options='{"widget": "monetary", "display_currency": "currency"}'/></td>
                                        </tr>
                                      </t>
                                  </tbody>
                                </table>

                              </div>
                              <div class="col-lg-6">
                                <H3>Jersey</H3>
                                <table class="table table-condensed">
                                  <thead>
                                      <tr>
                                        <th>#</th>
                                        <th>Couleur</th>
                                        <th>Taille</th>
                                        <th>Etat</th>
                                      </tr>
                                  </thead>
                                  <tbody>
                                      <t t-foreach="child_partner.jerseys_ids" t-as="jersey">
                                        <tr>
                                          <td><span t-field="jersey.number"/></td>
                                          <td><span t-field="jersey.size"/></td>
                                          <td><span t-field="jersey.color"/></td>
                                          <td><span t-field="jersey.state"/></td>
                                        </tr>
                                      </t>
                                  </tbody>
                                </table>
                              </div>
                            </div>
                            <div t-if="child_partner.is_player" class="row">
                              <div class="col-lg-6">
                                <H3>Prochains matches</H3>
                                  <table class="table table-condensed data_calendar_table">
                                    <thead>
                                      <tr>
                                        <th class="col-md-2">Date</th>
                                        <th class="col-md-1"/>
                                        <th class="col-md-3">Adversaire</th>
                                        <th class="col-md-3">Lieu</th>
                                        <th class="col-md-3">Heure</th>
                                        <th class="col-md-2"></th>

                                      </tr>
                                    </thead>
                                    <tbody>
                                      <t t-set="now" t-value="datetime.datetime.now().strftime('%Y-%m-%d %H:%M:%S')"/>

                                      <t t-foreach="child_partner.game_ids.filtered(lambda r, now=now: r.start_time &gt; now) and child_partner.game_ids.filtered(lambda r, now=now: r.start_time &gt; now)[:5] or []" t-as="game">
                                        <t t-set="team" t-value="game.home_team if game.home_team in child_partner.team_ids else game.away_team"/>
                                        <t t-call="baseball.table_game_calendar"/>
                                      </t>
                                    </tbody>
                                  </table>
                              </div>
                              <div class="col-lg-6">
                                <H3>Prochains entraînements</H3>
                                  <table class="table table-condensed data_calendar_table">
                                    <thead>
                                      <tr>
                                        <th class="col-md-2">Date</th>
                                        <th class="col-md-2">Heure</th>
                                        <th class="col-md-3">Lieu</th>

                                      </tr>
                                    </thead>
                                    <tbody>
                                      <t t-set="now" t-value="datetime.datetime.now().strftime('%Y-%m-%d %H:%M:%S')"/>

                                      <t t-foreach="child_partner.practice_event_ids.filtered(lambda r, now=now: r.start_time &gt; now) and child_partner.practice_event_ids.filtered(lambda r, now=now: r.start_time &gt; now)[:5] or []" t-as="practice">
                                        <tr>
                                          <td><span t-field="practice.start_time" t-field-options='{"format": "dd/MM/yy"}'/></td>
                                          <td><span  t-field="practice.start_time" t-field-options='{"format": "HH:mm"}'/></td>
                                          <td><span t-field="practice.venue_id.name"/></td>
                                        </tr>
                                      </t>
                                    </tbody>
                                  </table>
                              </div>
                            </div>
                          </div>
                        </t>
                    </div>
                  </div>
                </div>  
              </div>
            </div>
          </div>
        <div class="oe_structure mb32"/>
      </div>
  </t>
</template>



  </data>
</openerp>